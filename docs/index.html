<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI-Driven Fraud Case Summarizer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Georgia, "Times New Roman", Times, serif;
            line-height: 1.7;
            color: #333;
            background-color: #fff;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
        }

        header {
            border-bottom: 2px solid #000;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }

        header h1 {
            font-size: 2em;
            font-weight: normal;
            margin-bottom: 8px;
            color: #000;
        }

        header .subtitle {
            font-size: 1.1em;
            color: #555;
            font-style: italic;
            margin-bottom: 15px;
        }

        .nav-links {
            font-size: 0.9em;
            color: #666;
        }

        .nav-links a {
            color: #0066cc;
            text-decoration: none;
            margin-right: 15px;
        }

        .nav-links a:hover {
            text-decoration: underline;
        }

        section {
            margin-bottom: 40px;
        }

        h2 {
            font-size: 1.5em;
            font-weight: normal;
            margin-bottom: 15px;
            border-bottom: 1px solid #ccc;
            padding-bottom: 5px;
            color: #000;
        }

        h3 {
            font-size: 1.2em;
            font-weight: normal;
            margin-top: 20px;
            margin-bottom: 10px;
            color: #000;
        }

        h4 {
            font-size: 1.05em;
            font-weight: 600;
            margin-top: 15px;
            margin-bottom: 8px;
            color: #000;
        }

        p {
            margin-bottom: 12px;
            text-align: justify;
        }

        ul {
            margin-left: 30px;
            margin-bottom: 15px;
        }

        ul li {
            margin-bottom: 6px;
        }

        .abstract {
            font-size: 0.95em;
            color: #444;
            padding: 15px 0;
            border-top: 1px solid #ddd;
            border-bottom: 1px solid #ddd;
            margin: 20px 0;
        }

        .status-line {
            font-size: 0.9em;
            color: #666;
            font-style: italic;
            margin-bottom: 15px;
            padding: 10px;
            background: #f9f9f9;
            border-left: 3px solid #999;
        }

        .case-explorer-controls {
            margin-bottom: 20px;
        }

        label {
            display: block;
            font-weight: 600;
            margin-bottom: 6px;
            color: #333;
            font-size: 0.95em;
        }

        select {
            width: 100%;
            padding: 8px;
            font-family: Georgia, "Times New Roman", Times, serif;
            font-size: 0.95em;
            border: 1px solid #999;
            background: white;
            cursor: pointer;
        }

        select:focus {
            outline: 2px solid #666;
            outline-offset: 2px;
        }

        .case-card {
            border: 1px solid #ccc;
            padding: 20px;
            margin-top: 20px;
            background: #fafafa;
        }

        .case-card h3 {
            margin-top: 0;
            font-weight: 600;
            color: #000;
        }

        .case-narrative {
            background: white;
            padding: 15px;
            margin: 15px 0;
            line-height: 1.8;
            border: 1px solid #ddd;
            font-size: 0.95em;
        }

        .case-narrative.collapsed {
            max-height: 150px;
            overflow: hidden;
            position: relative;
        }

        .case-narrative.collapsed::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 40px;
            background: linear-gradient(transparent, white);
        }

        .expand-btn {
            font-size: 0.85em;
            color: #0066cc;
            cursor: pointer;
            text-decoration: underline;
            background: none;
            border: none;
            padding: 0;
            margin-top: 5px;
        }

        .why-flagged {
            margin-top: 15px;
            padding: 15px;
            background: white;
            border: 1px solid #ddd;
        }

        .why-flagged h4 {
            color: #c00;
        }

        .why-flagged ul {
            list-style-type: disc;
            margin-left: 25px;
        }

        .case-links {
            margin-top: 15px;
            font-size: 0.9em;
        }

        .case-links a {
            color: #0066cc;
            text-decoration: none;
            margin-right: 12px;
        }

        .case-links a:hover {
            text-decoration: underline;
        }

        button {
            font-family: Georgia, "Times New Roman", Times, serif;
            font-size: 0.9em;
            padding: 6px 12px;
            border: 1px solid #999;
            background: white;
            cursor: pointer;
            margin-top: 10px;
            margin-right: 8px;
        }

        button:hover {
            background: #f5f5f5;
        }

        .code-block {
            background: #f4f4f4;
            padding: 15px;
            border: 1px solid #ddd;
            overflow-x: auto;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.85em;
        }

        .code-block code {
            display: block;
            white-space: pre;
            line-height: 1.5;
        }

        details {
            margin: 20px 0;
            border: 1px solid #ddd;
            padding: 15px;
            background: #fafafa;
        }

        summary {
            cursor: pointer;
            font-weight: 600;
            font-size: 1.1em;
            margin-bottom: 10px;
        }

        details[open] summary {
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #ddd;
        }

        .error-message {
            background: #fff5f5;
            color: #c00;
            padding: 15px;
            border: 1px solid #fcc;
            margin: 15px 0;
        }

        .loading-message {
            background: #f0f8ff;
            color: #0066cc;
            padding: 15px;
            text-align: center;
            margin: 15px 0;
            border: 1px solid #cce;
        }

        footer {
            margin-top: 50px;
            padding-top: 20px;
            border-top: 1px solid #ccc;
            text-align: center;
            font-size: 0.85em;
            color: #666;
        }

        footer a {
            color: #0066cc;
            text-decoration: none;
        }

        footer a:hover {
            text-decoration: underline;
        }

        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #333;
            color: white;
            padding: 12px 20px;
            border-radius: 4px;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 1000;
            font-size: 0.9em;
        }

        .toast.show {
            opacity: 1;
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            header h1 {
                font-size: 1.5em;
            }

            header .subtitle {
                font-size: 1em;
            }

            .nav-links {
                font-size: 0.85em;
            }

            .nav-links a {
                display: inline-block;
                margin-bottom: 5px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>AI-Driven Fraud Case Summarizer</h1>
            <p class="subtitle">From transaction signals to investigation-ready narratives (XGBoost + SHAP + Flan-T5)</p>
            <div class="nav-links">
                <a href="https://pranshu-dhingra.github.io/">Back to portfolio</a>
                <a href="https://pranshu-dhingra.github.io/projects.html">Projects</a>
                <a href="https://github.com/pranshu-dhingra/AI-Driven-Fraud-Case-Summarizer">Repository</a>
                <a href="https://github.com/pranshu-dhingra/AI-Driven-Fraud-Case-Summarizer/tree/main/src">Source (src/)</a>
                <a href="https://github.com/pranshu-dhingra/AI-Driven-Fraud-Case-Summarizer/tree/main/outputs">Outputs</a>
            </div>
        </header>

        <section id="abstract">
            <h2>Abstract</h2>
            <div class="abstract">
                <p>This work presents an end-to-end pipeline that transforms structured fraud detection outputs into human-readable case summaries using interpretable machine learning and small language models. We combine XGBoost anomaly classification with SHAP (SHapley Additive exPlanations) for local interpretability, converting quantitative feature attributions into natural language silver labels. These enriched explanations serve as training signals for a fine-tuned Flan-T5 model, which generates investigation-ready fraud narratives complete with risk assessments and actionable recommendations for fraud analysts.</p>
            </div>
        </section>

        <section id="case-explorer">
            <h2>Case Explorer</h2>
            <div class="status-line" id="status-line">Loading cases from repository outputs...</div>
            
            <div class="case-explorer-controls">
                <label for="case-select">Select a case:</label>
                <select id="case-select">
                    <option value="">Loading...</option>
                </select>
            </div>

            <div id="case-display"></div>
        </section>

        <details id="methods">
            <summary>Methods</summary>
            <p>The pipeline consists of six primary stages:</p>
            <ul>
                <li><strong>Data Ingestion & Feature Engineering:</strong> Card transaction data undergoes comprehensive preprocessing, extracting temporal patterns, merchant analytics, velocity metrics, and customer behavior profiles.</li>
                <li><strong>Anomaly Detection:</strong> XGBoost classifier trained on historical fraud patterns identifies suspicious transactions with high precision, producing probability scores for each transaction.</li>
                <li><strong>Explainability via SHAP:</strong> SHAP values quantify each feature's contribution to the fraud score, providing both local (per-transaction) and global (dataset-level) interpretability.</li>
                <li><strong>Silver Labeling:</strong> SHAP outputs are systematically converted into structured natural language descriptions, creating pseudo-labels that bridge quantitative signals and linguistic explanations.</li>
                <li><strong>SLM Fine-Tuning:</strong> Flan-T5 (a small, efficient transformer) is fine-tuned on SHAP-enriched examples to generate contextual fraud case narratives that synthesize risk factors into coherent investigative summaries.</li>
                <li><strong>Output Generation:</strong> The trained model produces investigation-ready narratives, SHAP visualizations, and structured metadata for review by fraud analysts and audit systems.</li>
            </ul>
        </details>

        <section id="reproducibility">
            <h2>Reproducibility</h2>
            <p>The complete pipeline can be reproduced by executing the following modules in sequence:</p>
            <div class="code-block">
                <code>python -m src.data_preprocessing
python -m src.feature_engineering
python -m src.anomaly_labeling
python -m src.xgb_interpret
python -m src.shap_enrichment
python -m src.slm_train
python -m src.inference</code>
            </div>
            <p>Alternatively, run the provided shell script: <code>bash run_pipeline.sh</code></p>
            <p>Generated narratives and artifacts will be saved in the <code>outputs/</code> directory.</p>
        </section>

        <section id="repository">
            <h2>Repository Map</h2>
            <ul>
                <li><a href="https://github.com/pranshu-dhingra/AI-Driven-Fraud-Case-Summarizer">README</a> – Project overview and setup instructions</li>
                <li><a href="https://github.com/pranshu-dhingra/AI-Driven-Fraud-Case-Summarizer/tree/main/src">src/</a> – Pipeline modules (preprocessing, XGBoost, SHAP, SLM training, inference)</li>
                <li><a href="https://github.com/pranshu-dhingra/AI-Driven-Fraud-Case-Summarizer/tree/main/outputs">outputs/</a> – Generated case narratives and artifacts</li>
                <li><a href="https://github.com/pranshu-dhingra/AI-Driven-Fraud-Case-Summarizer/tree/main/data">data/</a> – Raw and processed transaction datasets</li>
                <li><a href="https://github.com/pranshu-dhingra/AI-Driven-Fraud-Case-Summarizer/tree/main/models">models/</a> – Saved XGBoost and Flan-T5 checkpoints</li>
            </ul>
        </section>

        <section id="references">
            <h2>References</h2>
            <ul>
                <li>Lundberg, S. M., & Lee, S. I. (2017). A unified approach to interpreting model predictions. <em>NeurIPS</em>.</li>
                <li>Chung, H. W., et al. (2022). Scaling Instruction-Finetuned Language Models. <em>arXiv preprint</em>.</li>
                <li>Chen, T., & Guestrin, C. (2016). XGBoost: A scalable tree boosting system. <em>KDD</em>.</li>
            </ul>
        </section>

        <footer>
            <p>Static demo hosted on GitHub Pages • <a href="https://github.com/pranshu-dhingra/AI-Driven-Fraud-Case-Summarizer">View Repository</a> • <a href="https://pranshu-dhingra.github.io/">Back to portfolio</a></p>
        </footer>
    </div>

    <div id="toast" class="toast"></div>

    <script>
        let casesData = [];
        let usingFallback = false;

        // GitHub API configuration
        const GITHUB_API = 'https://api.github.com/repos/pranshu-dhingra/AI-Driven-Fraud-Case-Summarizer/contents/outputs';
        const REPO_BASE = 'https://github.com/pranshu-dhingra/AI-Driven-Fraud-Case-Summarizer/blob/main/outputs';

        // Load cases on page load
        async function loadCases() {
            try {
                updateStatus('Fetching case files from outputs/ via GitHub API...');
                const files = await fetchOutputFiles();
                
                if (files && files.length > 0) {
                    updateStatus(`Found ${files.length} files in outputs/. Selecting representative cases...`);
                    const cases = await buildCasesFromFiles(files);
                    
                    if (cases.length > 0) {
                        casesData = cases;
                        updateStatus(`Loaded ${cases.length} cases from outputs/`);
                        populateDropdown();
                        if (casesData.length > 0) {
                            displayCase(casesData[0]);
                        }
                        return;
                    }
                }
                
                // If we get here, fall back
                throw new Error('No valid cases found in outputs/');
                
            } catch (error) {
                console.error('Error loading from GitHub API:', error);
                await loadFallbackCases();
            }
        }

        async function fetchOutputFiles() {
            try {
                const response = await fetch(GITHUB_API);
                if (!response.ok) {
                    throw new Error(`GitHub API returned ${response.status}`);
                }
                const data = await response.json();
                
                // Filter for text files and spreadsheets
                const files = data.filter(item => {
                    const name = item.name.toLowerCase();
                    return item.type === 'file' && 
                           (name.endsWith('.txt') || name.endsWith('.md') || 
                            name.endsWith('.json') || name.endsWith('.xlsx'));
                });
                
                return files;
            } catch (error) {
                console.error('Failed to fetch from GitHub API:', error);
                return null;
            }
        }

        async function buildCasesFromFiles(files) {
            const cases = [];
            // Select up to 5 representative files
            const selectedFiles = files.slice(0, 5);
            
            for (const file of selectedFiles) {
                try {
                    // For .xlsx files, we can't easily parse them, so just create a reference
                    if (file.name.endsWith('.xlsx')) {
                        const caseId = file.name.replace(/\.(xlsx|xls)$/i, '');
                        cases.push({
                            id: caseId,
                            title: humanizeFilename(file.name),
                            narrative: `This file contains tabular fraud case data. Download the file to view detailed case information, SHAP values, and model predictions. The spreadsheet includes structured data from the AI pipeline's inference stage.`,
                            links: {
                                output: `${REPO_BASE}/${file.name}`,
                                raw: file.download_url
                            }
                        });
                    } else if (file.download_url && (file.name.endsWith('.txt') || file.name.endsWith('.md'))) {
                        // Fetch text content
                        const content = await fetchFileContent(file.download_url);
                        if (content && content.trim().length > 0) {
                            const caseId = file.name.replace(/\.(txt|md)$/i, '');
                            cases.push({
                                id: caseId,
                                title: humanizeFilename(file.name),
                                narrative: content.trim(),
                                links: {
                                    output: `${REPO_BASE}/${file.name}`,
                                    raw: file.download_url
                                }
                            });
                        }
                    }
                } catch (error) {
                    console.error(`Failed to process file ${file.name}:`, error);
                }
            }
            
            return cases;
        }

        async function fetchFileContent(url) {
            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`Failed to fetch ${url}`);
                }
                const text = await response.text();
                return text;
            } catch (error) {
                console.error('Failed to fetch file content:', error);
                return null;
            }
        }

        function humanizeFilename(filename) {
            // Remove extension
            let name = filename.replace(/\.(txt|md|json|xlsx|xls)$/i, '');
            // Replace underscores and hyphens with spaces
            name = name.replace(/[_-]/g, ' ');
            // Title case
            name = name.split(' ')
                .map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase())
                .join(' ');
            return name;
        }

        async function loadFallbackCases() {
            try {
                updateStatus('Live outputs could not be loaded; showing fallback examples.');
                usingFallback = true;
                
                const response = await fetch('./cases.fallback.json');
                if (!response.ok) {
                    throw new Error('Failed to load fallback cases');
                }
                casesData = await response.json();
                populateDropdown();
                
                if (casesData.length > 0) {
                    displayCase(casesData[0]);
                }
            } catch (error) {
                console.error('Error loading fallback cases:', error);
                displayError('Failed to load case data. Please check that the demo files are accessible.');
            }
        }

        function updateStatus(message) {
            const statusLine = document.getElementById('status-line');
            statusLine.textContent = message;
        }

        function populateDropdown() {
            const select = document.getElementById('case-select');
            select.innerHTML = '<option value="">-- Select a case --</option>';
            
            casesData.forEach((caseItem, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = `${caseItem.id}: ${caseItem.title}`;
                select.appendChild(option);
            });

            // Set first case as selected
            if (casesData.length > 0) {
                select.value = '0';
            }

            select.addEventListener('change', (e) => {
                const index = e.target.value;
                if (index !== '') {
                    displayCase(casesData[index]);
                } else {
                    document.getElementById('case-display').innerHTML = '';
                }
            });
        }

        function displayCase(caseItem) {
            const display = document.getElementById('case-display');
            
            // Check if narrative is long (more than 500 chars)
            const isLong = caseItem.narrative.length > 500;
            const narrativeClass = isLong ? 'case-narrative collapsed' : 'case-narrative';
            const narrativeId = `narrative-${caseItem.id}`;
            
            let whyFlaggedSection = '';
            if (caseItem.why_flagged && caseItem.why_flagged.length > 0) {
                whyFlaggedSection = `
                    <div class="why-flagged">
                        <h4>Why This Transaction Was Flagged</h4>
                        <ul>
                            ${caseItem.why_flagged.map(reason => `<li>${reason}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }
            
            const html = `
                <div class="case-card">
                    <h3>${caseItem.title}</h3>
                    
                    <h4>Generated Narrative</h4>
                    <div class="${narrativeClass}" id="${narrativeId}">
                        ${caseItem.narrative}
                    </div>
                    ${isLong ? `<button class="expand-btn" onclick="toggleNarrative('${narrativeId}', this)">Show more</button>` : ''}

                    ${whyFlaggedSection}

                    <div class="case-links">
                        <a href="${caseItem.links.output}" target="_blank">View output in repo</a>
                        <a href="${caseItem.links.raw}" target="_blank">View raw file</a>
                    </div>

                    <button onclick="copyNarrative('${caseItem.id}')">Copy narrative</button>
                </div>
            `;
            
            display.innerHTML = html;
        }

        function toggleNarrative(narrativeId, button) {
            const narrative = document.getElementById(narrativeId);
            const isCollapsed = narrative.classList.contains('collapsed');
            
            if (isCollapsed) {
                narrative.classList.remove('collapsed');
                button.textContent = 'Show less';
            } else {
                narrative.classList.add('collapsed');
                button.textContent = 'Show more';
            }
        }

        function displayError(message) {
            const display = document.getElementById('case-display');
            display.innerHTML = `
                <div class="error-message">
                    <strong>Error:</strong> ${message}
                </div>
            `;
        }

        function copyNarrative(caseId) {
            const caseItem = casesData.find(c => c.id === caseId);
            if (!caseItem) return;

            const textToCopy = `${caseItem.title}\n\n${caseItem.narrative}`;
            
            navigator.clipboard.writeText(textToCopy).then(() => {
                showToast('Narrative copied to clipboard');
            }).catch(err => {
                console.error('Failed to copy:', err);
                showToast('Failed to copy narrative');
            });
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', loadCases);
    </script>
</body>
</html>
